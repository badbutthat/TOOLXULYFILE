from colorama import init, Fore, Back, Style
import fitz  # PyMuPDF
from reportlab.pdfgen import canvas
import os
import shutil
from PIL import Image, ImageEnhance
from zipfile import ZipFile
import subprocess
from concurrent.futures import ThreadPoolExecutor
import time
def zip_single_folder(input_output_tuple):
    input_folder, output_folder = input_output_tuple
    folder_name = os.path.basename(input_folder)
    output_zip = os.path.join(output_folder, f'{folder_name}.zip')

    with ZipFile(output_zip, 'w') as zipf:
        for root, dirs, files in os.walk(input_folder):
            for file in files:
                file_path = os.path.join(root, file)
                arcname = os.path.relpath(file_path, input_folder)
                zipf.write(file_path, arcname)

    print(f'ÄÃ£ nÃ©n thÃ nh cÃ´ng thÆ° má»¥c {folder_name} vÃ o {output_zip}')

def zip_folders(input_folder, output_folder):
    input_output_tuples = [(os.path.join(input_folder, folder_name), output_folder) for folder_name in os.listdir(input_folder) if os.path.isdir(os.path.join(input_folder, folder_name))]

    with ThreadPoolExecutor() as executor:
        executor.map(zip_single_folder, input_output_tuples)
def process_names(name,base_name_zip):
    # Thá»±c hiá»‡n Ä‘á»•i tÃªn theo quy chuáº©n
    parts = name.split('_')
    year = parts[0]
    month = '0'+str(int(parts[1])) if len(parts) > 1 else '01'
    new_name = f'{base_name_zip}.{year}.{month}'
    return new_name

def DoitenNhieu_folders(input_folder):
    base_name = input('Nháº­p TÃªn CÆ¡ Báº£n Cá»§a xÃ£, VD: xatucuong_hgl_thd\n').lower()
    #print(base_name)
    #input()
    lso = ['HN','KS','KT','KH']
    for root, dirs, files in os.walk(input_folder):
        if str(root[-2:]) in lso:
            loaiso = base_name+'.'+str(root[-2:])

            for item_name in os.listdir(root):
                item_path = os.path.join(root, item_name)
                if os.path.isdir(item_path) and "_thd." not in item_name:
                    # Xá»­ lÃ½ tÃªn thÆ° má»¥c
                    new_name = process_names(item_name,loaiso)
                    new_path = os.path.join(root, new_name)
                    os.rename(item_path, new_path)
                    print(f'DÃ£ Ä‘á»•i tÃªn thÆ° má»¥c: {item_name} -> {new_name}')

                elif os.path.isfile(item_path):
                    # Xá»­ lÃ½ tÃªn tá»‡p tin
                    file_name, file_ext = os.path.splitext(item_name)
                    if "_thd." not in file_name:
                        new_name = process_names(file_name,loaiso) + file_ext
                        new_path = os.path.join(root, new_name)
                        os.rename(item_path, new_path)
                        print(f'ÄÃ£ Ä‘á»•i tÃªn tá»‡p tin: {item_name} -> {new_name}')
def zipNhieu_folders(input_folder):
    input_output_tuples = []

    for root, dirs, files in os.walk(input_folder):
        for folder_name in dirs:
            if "_thd." in folder_name:
                folder_path = os.path.join(root, folder_name)
                input_output_tuples.append((folder_path, root))

    with ThreadPoolExecutor() as executor:
        executor.map(zip_single_folder, input_output_tuples)


def rename_files_and_folders(base_path ,base_name_zip):
    for item_name in os.listdir(base_path):
        item_path = os.path.join(base_path, item_name)

        if os.path.isdir(item_path) and "_thd." not in item_name:
            # Xá»­ lÃ½ tÃªn thÆ° má»¥c
            new_name = process_name(item_name)
            new_path = os.path.join(base_path, new_name)
            os.rename(item_path, new_path)
            print(f'DÃ£ Ä‘á»•i tÃªn thÆ° má»¥c: {item_name} -> {new_name}')

        elif os.path.isfile(item_path)  :
            # Xá»­ lÃ½ tÃªn tá»‡p tin
            file_name, file_ext = os.path.splitext(item_name)
            if "_thd." not in file_name:
                new_name = process_name(file_name) + file_ext
                new_path = os.path.join(base_path, new_name)
                os.rename(item_path, new_path)
                print(f'ÄÃ£ Ä‘á»•i tÃªn tá»‡p tin: {item_name} -> {new_name}')


def process_name(name):
    # Thá»±c hiá»‡n Ä‘á»•i tÃªn theo quy chuáº©n
    parts = name.split('_')
    year = parts[0]
    month = '0'+str(int(parts[1])) if len(parts) > 1 else '01'
    new_name = f'{base_name_zip}.{year}.{month}'
    return new_name

def pdf_to_jpg(input_path, output_path, qlt):
    # Kiá»ƒm tra xem thÆ° má»¥c Ä‘áº§u ra cÃ³ tá»“n táº¡i hay khÃ´ng, náº¿u khÃ´ng thÃ¬ táº¡o má»›i
    if not os.path.exists(output_path):
        os.makedirs(output_path)

    # Láº·p qua táº¥t cáº£ cÃ¡c tá»‡p PDF trong thÆ° má»¥c Ä‘áº§u vÃ o
    for filename in os.listdir(input_path):
        if filename.endswith(".pdf"):
            pdf_path = os.path.join(input_path, filename)
            doc = fitz.open(pdf_path)

            # Láº·p qua tá»«ng trang trong PDF
            for page_num in range(doc.page_count):
                page = doc[page_num]

                # LÆ°u trang dÆ°á»›i dáº¡ng tá»‡p JPG
                img_filename = f"{os.path.splitext(filename)[0]}.jpg"
                img_path = os.path.join(output_path, img_filename)
                pix = page.get_pixmap()

                # Sá»­ dá»¥ng Pillow Ä‘á»ƒ lÆ°u tá»‡p JPG
                img = Image.frombytes("RGB", [pix.width, pix.height], pix.samples)

                if not qlt:
                    qlt = 100
                else:
                    qlt = int(qlt)

                img.save(img_path, "JPEG",quality=qlt)

            doc.close()

def jpg_to_pdf(input_folder, output_path):
    # Kiá»ƒm tra xem thÆ° má»¥c Ä‘áº§u ra cÃ³ tá»“n táº¡i hay khÃ´ng, náº¿u khÃ´ng thÃ¬ táº¡o má»›i
    if not os.path.exists(output_path):
        os.makedirs(output_path)

    # Láº·p qua táº¥t cáº£ cÃ¡c tá»‡p JPG trong thÆ° má»¥c Ä‘áº§u vÃ o
    for filename in os.listdir(input_folder):
        if filename.endswith(".jpg"):
            img_path = os.path.join(input_folder, filename)

            # Táº¡o má»™t tá»‡p PDF má»›i cho má»—i áº£nh
            pdf_output_path = os.path.join(output_path, f"{os.path.splitext(filename)[0]}.pdf")

            # Táº¡o PDF vÃ  thÃªm áº£nh vÃ o
            c = canvas.Canvas(pdf_output_path)
            img = Image.open(img_path)
            width, height = img.size

            # Thiáº¿t láº­p kÃ­ch thÆ°á»›c trang PDF theo kÃ­ch thÆ°á»›c áº£nh
            c.setPageSize((width, height))
            c.drawImage(img_path, 0, 0, width, height)

            # LÆ°u tá»‡p PDF
            c.save()
def move_files(choice, root_path, destination_path):
    if not os.path.exists(destination_path):
        os.makedirs(destination_path)

    if choice == '3':
        move_to_destination = True
        print(0)
    elif choice == '4':
        move_to_destination = False
        print(1)
        print(root_path)

    file_list = []
    for root, dirs, files in os.walk(root_path):
        for file in files:
            file_list.append(os.path.join(root, file))

    for file in file_list:
        relative_path = os.path.relpath(file, root_path)
        #print(relative_path)


        if move_to_destination:
            new_name = relative_path.replace('\\', '=')

            destination = os.path.join(destination_path, new_name)
            shutil.move(file, destination)
            print(destination)
        else:
            try:
                #relative_path = os.path.relpath(file, destination_path)
                #print(relative_path)
                new_name = relative_path.replace('=', '\\')
                destination = os.path.join(destination_path, new_name)
                print(destination)
                shutil.move(file, destination)
                #input()
            except:
                pass
    print("\n\n"+f"ÄÃ£ Di Chuyá»ƒn ThÃ nh CÃ´ng {len(file_list)} Files Tá»« {root_path} Äáº¿n {destination_path}")

def xulimang(input_list):
    #input_list = sortlistarr(input_list)
    result_list = []
    i = 0

    while i < len(input_list):
        current_element = input_list[i]
        #print('curentelement',current_element)
        # Kiá»ƒm tra xem pháº§n tá»­ cÃ³ chá»‰ sá»‘ phá»¥ hay khÃ´ng
        if '(' in current_element and ')' in current_element:
            base_number, sub_index = current_element.split('(')
            sub_index = sub_index.rstrip(')')
            sub_index = int(sub_index)
            base_number = int(base_number)
            # Khá»Ÿi táº¡o danh sÃ¡ch Ä‘á»ƒ chá»©a cÃ¡c sá»‘ liÃªn tiáº¿p cÃ¹ng chá»‰ sá»‘
            consecutive_numbers = [base_number]
            index_r = 1
            # Kiá»ƒm tra pháº§n tá»­ tiáº¿p theo cÃ³ cÃ¹ng chá»‰ sá»‘ phá»¥ hay khÃ´ng
            while i + 1 < len(input_list) and '(' in input_list[i + 1] and ')' in input_list[i + 1]:
                next_base_number, next_sub_index = input_list[i + 1].split('(')
                next_sub_index = next_sub_index.rstrip(')')
                next_sub_index = int(next_sub_index)
                next_base_number = int(next_base_number)
                #print(sub_index == next_sub_index)
                # Náº¿u chá»‰ sá»‘ phá»¥ giá»‘ng nhau, thÃªm sá»‘ vÃ o danh sÃ¡ch
                if sub_index == next_sub_index and base_number + index_r == next_base_number:
                    consecutive_numbers.append(next_base_number)
                    i += 1
                else:
                    break

                index_r += 1

            # Táº¡o chuá»—i káº¿t quáº£ vá»›i danh sÃ¡ch cÃ¡c sá»‘ liÃªn tiáº¿p
            if len(consecutive_numbers) > 1:
                base_number_str = f'{consecutive_numbers[0]}-{consecutive_numbers[-1]}'
                result_list.append(f'({base_number_str})({sub_index})')
                #print(base_number_str)
            else:
                result_list.append(f'{base_number}({sub_index})')
                # print(f'{base_number}({sub_index})')
        else:
            # Kiá»ƒm tra xem pháº§n tá»­ tiáº¿p theo cÃ³ chá»‰ sá»‘ phá»¥ hay khÃ´ng
            if i + 1 < len(input_list) and '(' not in input_list[i + 1] and ')' not in input_list[i + 1]:
                current_element = int(current_element)
                next_base_number = current_element + 1
                index_l =1
                #print(i + 1 < len(input_list) and '(' not in input_list[i + 1] and ')' not in input_list[i + 1])
                while i + 1 < len(input_list) and '(' not in str(input_list[i + 1]) and ')' not in str(input_list[i + 1]):
                    #print(current_element + index_l )
                    #print(input_list[i+1])
                    try:
                        if int(current_element + index_l) == int(input_list[i+1]):
                            next_base_number = input_list[i+1]
                            index_l += 1
                            #print('zo if')
                        else:
                            break
                            #print("beak")
                        i += 1
                    except:
                        break

                #print(next_base_number)
                result_list.append(f'{current_element}-{next_base_number}')
            else:
                result_list.append(current_element)

        i += 1
    return result_list
def rename_files(directory):
    files = sorted([file_name for file_name in os.listdir(directory) if '_' in file_name], key=lambda x: int(x.split('_')[0]))
    # print(files)

    dict_name_file = {i: 0 for i in range(1, 1001)}

    for file_name in files :
        base_name, ext = os.path.splitext(file_name)
        parts = base_name.split('_')

        # print(parts)

        if len(parts) == 2:
            prefix, range_part = parts
            # print(range_part)
            if '-' in str(range_part):
                start, end = map(int, range_part.split('-'))
                list_temp = [i for i in range(int(start), int(end) + 1)]
            else:
                list_temp = [int(range_part)]
            # print(list_temp)
            name_re = ''
            next = False
            for temps in list_temp:
                if dict_name_file[temps] > 0:
                    next = True

            if next:
                for temps in list_temp:
                    if dict_name_file[temps] > 0:
                        name_re += f"{temps}({dict_name_file[temps]}),"
                    else:
                        name_re += f"{temps},"
                    dict_name_file[temps] += 1
                    # dict_name_file[temps] = dict_name_file.get(temps, 0) + 1
                    # print("sucess")
                name_re = name_re.rstrip(',')
            elif not next:
                for temps in list_temp:
                    dict_name_file[temps] += 1
                name_re = range_part

            name_re = name_re.split(',')
            name_re = list(filter(None, name_re))
            name_re =xulimang(name_re)
            name_re = ','.join(name_re)
            name_re = name_re.rstrip(',') + ext
            os.rename(os.path.join(directory, file_name), os.path.join(directory, name_re))
            print("ÄÃ£ Äá»•i tÃªn má»›i thÃ nh cÃ´ng tá»« : ", file_name, " --> ", name_re)

        if len(parts) > 2:

            checks = False
            name_re = ''
            for data_v in parts[1:]:
                #print(data_v)
                if '-' not in data_v and "b" not in data_v:
                    thangle = int(data_v)
                    if dict_name_file[thangle]:
                        name_re += f"{thangle}({dict_name_file[thangle]}),"
                    else:
                        name_re += f"{thangle},"
                    dict_name_file[thangle] += 1
                elif 'b' in data_v:
                    checks = True
                    loaibo = data_v.replace('b', '')
                    loaibo = loaibo.split(",") if ',' in loaibo else [loaibo]
                    #print("loai bo = ", loaibo)
                else:
                    # print(range_part)
                    start, end = map(int, data_v.split('-'))
                    list_temp = [i for i in range(start, end + 1)]
                    #print(list_temp)
                    # print(list_temp)
                    next = False
                    for temps in list_temp:
                        if dict_name_file[temps] > 0:
                            name_re += f'{temps}({dict_name_file[temps]}),'
                        else:
                            name_re += str(temps) +','
                        dict_name_file[temps] += 1
                    #print('tep sau khi fix',name_re)
            if checks:
                data = name_re.split(',')
                check_bo = data
                #print('tentruocbo', check_bo)

                for bodi in loaibo:
                    dict_name_file[int(bodi)] -= 1
                    check_bo = [i for i in check_bo if str(bodi) not in i[0:len(str(bodi))]]

                name_re = ','.join(check_bo)  # Initialize name_re with the modified check_bo outside the loop
                #print('tensaubo', name_re)

                #print(name_re)
            name_re = name_re.split(',')
            name_re = list(filter(None, name_re))
            name_re =xulimang(name_re)

            name_re = ','.join(name_re)
            name_re = name_re.rstrip(',') + ext
            os.rename(os.path.join(directory, file_name), os.path.join(directory, name_re))
            print("ÄÃ£ Äá»•i tÃªn má»›i thÃ nh cÃ´ng tá»« : ", file_name, " --> ", name_re)

def find_ghostscript_path():
    drive, _ = os.path.splitdrive(os.getcwd())
    ghostscript_path = os.path.join(drive, r'\gostscriptNenPdf\bin\gswin64c.exe')
    print(ghostscript_path)
    if os.path.exists(ghostscript_path):
        return ghostscript_path
    else:
        raise FileNotFoundError("KhÃ´ng tÃ¬m tháº¥y Ghostscript. HÃ£y kiá»ƒm tra Ä‘Æ°á»ng dáº«n.")

def compress_pdf(input_path, output_path, ghostscript_path):
    # Ensure the output folder exists
    output_folder = os.path.dirname(output_path)
    if not os.path.exists(output_folder):
        os.makedirs(output_folder)

    command = [
        ghostscript_path,
        "-sDEVICE=pdfwrite",
        "-dCompatibilityLevel=1.4",
        "-dPDFSETTINGS=/ebook",
        "-dNOPAUSE",
        "-dQUIET",
        "-dBATCH",
        "-sOutputFile=" + output_path,
         "-dDownScaleFactor=2",  # Set the general image resolution to 300 dpi
        input_path
    ]
    subprocess.run(command)
    print("Ä‘Ã£ nÃ©n thÃ nh cÃ´ng", input_path)

def compress_pdfs_in_folder(folder_path, ghostscript_path, pdf_luu, num_threads=12):
    if not os.path.exists(pdf_luu):
        os.makedirs(pdf_luu)
    pdf_files = [file for file in os.listdir(folder_path) if file.lower().endswith(".pdf")]

    # Kiá»ƒm tra xem cÃ³ nÃªn sá»­ dá»¥ng Ä‘a luá»“ng hay khÃ´ng
    if len(pdf_files) > 10:
        with ThreadPoolExecutor(max_workers=num_threads) as executor:
            # Táº¡o danh sÃ¡ch cÃ¡c nhiá»‡m vá»¥ Ä‘a luá»“ng
            tasks = []
            for pdf_file in pdf_files:
                input_pdf_path = os.path.join(folder_path, pdf_file)
                output_pdf_path = os.path.join(pdf_luu, pdf_file)

                # ThÃªm nhiá»‡m vá»¥ vÃ o danh sÃ¡ch
                tasks.append(executor.submit(compress_pdf, input_pdf_path, output_pdf_path, ghostscript_path))

            # Chá» cho táº¥t cáº£ cÃ¡c nhiá»‡m vá»¥ hoÃ n thÃ nh
            for future in tasks:
                future.result()
    else:
        # Náº¿u sá»‘ lÆ°á»£ng file khÃ´ng Ä‘á»§, thá»±c hiá»‡n nÃ©n má»™t láº§n
        for pdf_file in pdf_files:
            input_pdf_path = os.path.join(folder_path, pdf_file)
            output_pdf_path = os.path.join(pdf_luu, pdf_file)
            compress_pdf(input_pdf_path, output_pdf_path, ghostscript_path)


def handle_rename_files():
    print("--Replace TÃªn File--".center(60,"ğŸ˜"))
    folder_path = input("Nháº­p Ä‘Æ°á»ng dáº«n folder: ")
    old_text = input("Nháº­p text cÅ©: ( náº¿u khÃ´ng nháº­p máº·c Ä‘á»‹nh lÃ  --compressed)!")
    if not old_text:
        old_text = '--compressed'
        new_text = ''
    else:
        new_text = input("Nháº­p text má»›i: ")

    def rename_file(file_name):
        old_path = os.path.join(folder_path, file_name)
        new_file_name = file_name.replace(old_text, new_text)
        new_path = os.path.join(folder_path, new_file_name)

        os.rename(old_path, new_path)
        print(f"Ä‘Ã£ Äá»•i tÃªn tá»« : {file_name} -->> {new_file_name}")

    files = os.listdir(folder_path)
    start = time.time()

    with ThreadPoolExecutor() as executor:
        executor.map(rename_file, [file_name for file_name in files if old_text in file_name])

    print(f"Äá»•i tÃªn xong trong {time.time() - start} giÃ¢y")


try:
    if __name__ == "__main__":
        tieude = 'create by DuyKhanh '.center(100, '-')
        tenchuongtrinh = ' xulyfile v1.5.3 '.center(100,'*')
        while True:

            try:
                print(tenchuongtrinh)
                print(tieude)

                print("Chá»n quy trÃ¬nh chuyá»ƒn Ä‘á»•i:")
                print("1. PDF to JPG")
                print("2. JPG to PDF")
                print("3: Di chuyá»ƒn tá»« nhÃ¡nh thÆ° má»¥c vá» má»™t thÆ° má»¥c.")
                print('4: Di chuyá»ƒn tá»« má»™t thÆ° má»¥c vá» nhÃ¡nh thÆ° má»¥c.')
                print("5. Äá»•i tÃªn file trÃ¹ng sá»‘")
                print("6. Äá»•i tÃªn vÃ  Zip file ( BÆ°á»›c Cuá»‘i , Ä‘áº·t tÃªn vÃ  zip) ")
                print("7. NÃ©n PDF (beta)")
                print("8. Replace TÃªn File")
                print("9. ThoÃ¡t")

                choice = input("Nháº­p lá»±a chá»n cá»§a báº¡n (1/2/3/4/5/6/7/8/9/10): ")

                if choice == "1":
                    pdf_input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c chá»©a tá»‡p PDF: ").strip()
                    jpg_output_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c lÆ°u trá»¯ áº£nh JPG: ").strip()
                    quality = input("Nháº­p Cháº¥t lÆ°á»£ng hÃ¬nh áº£nh (40-100):").strip()
                    pdf_to_jpg(pdf_input_folder, jpg_output_folder, quality)
                    print("Chuyá»ƒn Ä‘á»•i hoÃ n thÃ nh.")
                elif choice == "2":
                    jpg_input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c chá»©a áº£nh JPG: ").strip()
                    pdf_output_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c lÆ°u trá»¯ tá»‡p PDF: ").strip()
                    jpg_to_pdf(jpg_input_folder, pdf_output_folder)
                    print("Chuyá»ƒn Ä‘á»•i hoÃ n thÃ nh.")
                elif choice == "3" or choice == '4':
                    root_path = input("Nháº­p thÆ° má»¥c ban Ä‘áº§u: ")
                    destination_path = input("Nháº­p thÆ° má»¥c Ä‘Ã­ch: ")
                    move_files(choice, root_path, destination_path)
                elif choice == '5':
                    print("\n\n\nLÆ°u Ã!!!\ncÃ¡ch Ä‘áº·t tÃªn Ä‘á»ƒ Ä‘á»•i cÃ³ Ä‘á»‹nh dáº¡ng :\n           thÃ¡ng_sá»‘-sá»‘ vÃ­ dá»¥ 1_1-6  \nnáº¿u sá»• cÃ³ hÆ¡n 2 trÆ°á»ng há»£p trong má»™t áº£nh thÃ¬ cÃ¡ch nhau báº±ng '_' vÃ­ dá»¥ :\nTrang thÃ¡ng 3 cÃ³ sá»‘ tá»« 1-6 vÃ  láº·p láº¡i 1 sáº½ Ä‘Æ°á»£c Ä‘áº·t lÃ  3_1-6_1\nNáº¿u cÃ³ trÆ°á»ng há»£p bá» vÃ­ dá»¥ lÃ  1 váº«n viáº¿t thÃªm _b1 bÃ¬nh thÆ°á»ng!")
                    pdf_path = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n PDF trÃ¹ng tÃªn cá»§a báº¡n: ").strip()
                    rename_files(pdf_path)
                    print("Chuyá»ƒn Ä‘á»•i hoÃ n thÃ nh!.")
                elif choice == '6':
                    print("Chá»n quy trÃ¬nh chuyá»ƒn Ä‘á»•i:")
                    print("1. Chá»‰ Äá»•i TÃªn Folder")
                    print("2. Chá»‰ Zip")
                    print("3: Vá»«a Äá»•i tÃªn vá»«a nÃ©n Folder.")
                    print("4: NÃ©n Nhiá»u Folder ( cáº£ xÃ£, huyá»‡n ).")
                    print("5: Äá»•i TÃªn Nhiá»u Folder vÃ  Files ( cáº£ xÃ£ ).")
                    print(" 6: Äá»•i TÃªn Nhiá»u Folder, Files vÃ  Zip ( cáº£ xÃ£ ).Nguy Hiá»ƒm ".center(100,'!'))
                    choie = input().strip()
                    if choie == "1":
                        input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n Folder chá»©a cÃ¡c folder muá»‘n Ä‘á»•i tÃªn: ").strip()
                        base_name_zip = input("Nháº­p tÃªn cÆ¡ báº£n cá»§a folder VD: xatrungkhanh_hgl_thd.KH\n").strip()
                        rename_files_and_folders(input_folder, base_name_zip)
                    elif choie == "2":
                        input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n Folder chá»©a cÃ¡c folder muá»‘n nÃ©n: ").strip()
                        zip_folders(input_folder, input_folder)
                    elif choie == "3":
                        input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n Folder chá»©a cÃ¡c folder muá»‘n Ä‘á»•i tÃªn vÃ  nÃ©n: ").strip()
                        base_name_zip = input("Nháº­p tÃªn cÆ¡ báº£n cá»§a folder VD: xatrungkhanh_hgl_thd.KH\n").strip()
                        rename_files_and_folders(input_folder, base_name_zip)
                        zip_folders(input_folder, input_folder)
                    elif choie == "4":
                        input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n Folder gá»‘c Ä‘á»ƒ nÃ©n: ").strip()
                        zipNhieu_folders(input_folder)
                    elif choie == "5":
                        input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n Folder gá»‘c chá»©a cÃ¡c loáº¡i sá»• : ").strip()
                        DoitenNhieu_folders(input_folder)
                    elif choie == "6":
                        input_folder = input("Nháº­p Ä‘Æ°á»ng dáº«n Ä‘áº¿n Folder gá»‘c chá»©a cÃ¡c loáº¡i sá»• : ").strip()
                        DoitenNhieu_folders(input_folder)
                        zipNhieu_folders(input_folder)
                    else:
                        print("Lá»±a chá»n khÃ´ng há»£p lá»‡. HÃ£y chá»n láº¡i.")
                    print("Chuyá»ƒn Ä‘á»•i hoÃ n thÃ nh.".center(100,'^'))
                elif choice == '7':
                    pdf_folder = input("Nháº­p ÄÆ°á»ng Dáº«n Folder Cáº§n NÃ©n PDF: ").strip()
                    pdf_luu = input("Nháº­p ÄÆ°á»ng Dáº«n Folder LÆ°u: ").strip()
                    # TÃ¬m Ä‘Æ°á»ng dáº«n Ghostscript
                    gs_path = find_ghostscript_path()
                    # NÃ©n táº¥t cáº£ cÃ¡c tá»‡p PDF trong thÆ° má»¥c sá»­ dá»¥ng Ä‘a luá»“ng náº¿u sá»‘ lÆ°á»£ng file lá»›n hÆ¡n 20
                    compress_pdfs_in_folder(pdf_folder, gs_path,pdf_luu)
                    print("NÃ©n ThÃ nh CÃ´ng")
                elif choice == '8':
                    handle_rename_files()
                elif choice == '9':
                    break
                else:
                    print("Lá»±a chá»n khÃ´ng há»£p lá»‡. HÃ£y chá»n láº¡i.")
            except:
                print("something went wrong please try again ")
except:
    print("something went wrong please try again ")
